---
    #Setup Play1: delete config on all switches
    - name: Delete config on all switches
      hosts: spine01:leaf01:leaf03
      become: yes

      tasks:
      #Task 1: Delete config on all switches
      - name: Delete config on all switches
        nclu:
          commands:
          - del all
          commit: true


    #Setup Play2: delete interface config from servers and reboot the server
    - name: delete interface config from servers and reboot the server
      hosts: server01:server03
      become: yes

      tasks:
      - name: Delete interface config from server
        blockinfile:
          path: /etc/network/interfaces
          marker: "# {mark} ANSIBLE MANAGED BLOCK"
          block: ""

      - name: Bring interface eth1 down
        command: ifdown eth1

      - name: Reboot server
        shell: "sleep 5 && reboot"
        async: 1
        poll: 0

      - name: Wait for hosts to finish reboot
        wait_for:
          host: "{{ (ansible_ssh_host|default(ansible_host))|default(inventory_hostname) }}"
          search_regex: OpenSSH
          delay: 10
          connection: local

      - name: Check the uptime post reboot
        shell: uptime
        register: UPTIME_POST_REBOOT

      - debug: msg={{UPTIME_POST_REBOOT.stdout}}